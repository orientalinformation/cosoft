<div class="container" *ngIf="study">

  <div class="card product-container" *ngIf="(study.CALCULATION_MODE ==1 && headBalanceResultsTr != '') || (study.CALCULATION_MODE !=1 && headBalanceResults != ''); else noResult">
    <div class="card-header text-center">
      <div class="btn-group" role="group">
        <button class="btn btn-outline-primary btn-sm" (click)="openPageHeat()" [class.active]="activePage == 'heat'">{{'Heat Balance'|translate}}</button>
        <button class="btn btn-outline-primary btn-sm" (click)="openPageCon()"  [class.active]="activePage == 'consumpt'">{{'Consumptions'|translate}}</button>
        <button class="btn btn-outline-primary btn-sm" (click)="openPageEco()"  [class.active]="activePage == 'economic'" *ngIf="study.OPTION_ECO">{{'Economics'|translate}}</button>
      </div>
    </div>
    <div class="card-body">
      <div style="margin-top:10px;display:block" id="pageHeat" *ngIf="study">
        <ng-template #showLoadingOptimum>
          <div class="text-center" *ngIf="study.CALCULATION_MODE == 2 || study.CALCULATION_MODE == 3" id="showLoaderChange"></div>
        </ng-template>
        <ng-template #showLoading>
            <div class="text-center" *ngIf="study.CALCULATION_MODE == 1" id="showLoader"></div>
        </ng-template>
        <h5 class="text-danger" style="font-weight:600">{{'Heat Balance'|translate}}</h5>
        <div id="pageHeadBalaceEstimation" *ngIf="study.CALCULATION_MODE == 1 && headBalanceResultsTr && showLoader == false;else showLoading">
          <div class="row">
              <div class="col-md-4" align="center" >
                  <label class="custom-control custom-radio" >
                    <input type="radio" class="custom-control-input" [(ngModel)]="trSelect" (change)="openTrPage(2)" [value]="2">{{'Control Temperature 10°C (18°F) colder.'|translate}}
                    <span class="custom-control-indicator"></span>
                  </label>
              </div>
              <div class="col-md-4" align="center" >
                  <label class="custom-control custom-radio" >
                    <input type="radio" class="custom-control-input" [(ngModel)]="trSelect" (change)="openTrPage(1)" [value]="1">{{'Control Temperature'|translate}}
                    <span class="custom-control-indicator"></span>
                  </label>
              </div>
              <div class="col-md-4" align="center" >
                  <label class="custom-control custom-radio" >
                    <input type="radio" class="custom-control-input"  [(ngModel)]="trSelect" (change)="openTrPage(0)" [value]="0">{{'Control Temperature 10°C (18°F) warmer.'|translate}}
                    <span class="custom-control-indicator"></span>
                  </label>
              </div>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-sm" *ngIf="resultAna">
              <tr *ngIf="symbol && resultAna">
                <td align="center" style="vertical-align: middle">{{'Required Production Rate'|translate}}</td>
                <td align="center" style="vertical-align: middle">{{resultAna.prodFlowRate}} ({{symbol.productFlowSymbol}})</td>
                <td align="center" style="vertical-align: middle">{{'Real product mass per unit'|translate}}</td>
                <td align="center" style="vertical-align: middle">{{ resultAna.prodElmtRealweight }}({{symbol.massSymbol}})</td>
                <td align="center" style="vertical-align: middle">{{'Initial Average Product temperature'|translate}}</td>
                <td align="center" style="vertical-align: middle">{{resultAna.avgTInitial}} ({{symbol.temperatureSymbol}})</td>
              </tr>
            </table>
          </div>
          <div class="table-responsive">
            <table class="table table-bordered table-sm" *ngIf="symbol">
              <tr>
                <td rowspan="2" align="center" style="vertical-align:middle;width:19%">{{'Calculate'|translate}}</td>
                <td rowspan="2" align="center" style="vertical-align:middle">{{'Control temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                <td rowspan="2" align="center" style="vertical-align:middle">{{'Product Heat Load'|translate}} ({{symbol.enthalpySymbol}})</td>
                <td rowspan="2" align="center" style="vertical-align:middle">{{'Final Average Product temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                <td colspan="2" align="center" style="vertical-align:middle">{{'Chosen product flowrate'|translate}}</td>
                <td colspan="3" align="center" style="vertical-align:middle">{{'Maximum product flowrate'|translate}}</td>
                <td rowspan="2" align="center" style="vertical-align:middle">{{'Precision of the high level calculation'|translate}}. ({{symbol.percentSymbol}})</td>
              </tr>
              <tr>
                <td align="center" style="vertical-align:middle">{{'Cryogen consumption (product + equipment heat load)'|translate}} ({{symbol.consumSymbol}}/{{symbol.perUnitOfMassSymbol}})</td>
                <td align="center" style="vertical-align:middle">{{'Conveyor coverage or quantity of product per batch'|translate}}</td>
                <td align="center" style="vertical-align:middle">{{'Hourly production capacity'|translate}} ({{symbol.productFlowSymbol}})</td>
                <td align="center" style="vertical-align:middle">{{'Cryogen consumption (product + equipment heat load)'|translate}} ({{symbol.consumSymbol}}/{{symbol.perUnitOfMassSymbol}})</td>
                <td align="center" style="vertical-align:middle">{{'Conveyor coverage or quantity of product per batch'|translate}}</td>
              </tr>
              <tr *ngFor="let result of headBalanceResultsTr" [style.background-color]="result.background">
                <td align="center" class="tdResultLink"style="vertical-align:middle">
                  <a href="javascript:;" class="tdResultLink" (click)="calculator.openBrain(result.id)">{{result.equipName}}</a>
                  <div *ngIf="result.specificSize != ''">
                    <div><a href="javascript:;" (click)="onEquipSizing(result.id)" style="color:#f00">{{'Specific equipment'|translate}}<br>{{result.specificSize}}</a></div>
                  </div>
                </td>
                <td align="center" class="tdResultAna" style="vertical-align:middle" *ngIf="isNumberic(result.tr) == true;else noTooltip">
                    <a href="javascript:;" placement="right" [ngbTooltip]="tipContent" (click)="viewEquipTr(result)">{{result.tr}}</a>
                    <ng-template #tipContent>
                      <div class="text-left" style="padding: 3px 0;font-size:13px">
                        <div style="white-space:nowrap">{{'Control temperature'|translate}}: <b>{{result.tr}}</b> ({{symbol.temperatureSymbol}})</div>
                        <div style="white-space:nowrap">{{'Residence/Dwell time'|translate}}: <b>{{result.ts}}</b> ({{symbol.timeSymbol}})</div>
                      </div>
                    </ng-template>
                  </td>
                  <ng-template #noTooltip>
                  <td align="center" class="tdResultAna" style="vertical-align:middle">
                    <a href="javascript:;">{{result.tr}}</a>
                  </td>  
                  </ng-template>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.vep}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tfp}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.conso}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.toc}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.dhp}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.consoMax}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tocMax}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.precision}}</td>
              </tr>
            </table>
          </div>
        </div>
        <div id="pageHeadBalaceOptimum" *ngIf="(study.CALCULATION_MODE == 2 || study.CALCULATION_MODE == 3) && headBalanceResults;else showLoadingOptimum">
            <div class="row">
                <div class="col-md-6" align="center" >
                  <label class="custom-control custom-radio" >
                    <input type="radio" class="custom-control-input" name="DHP" (change)="openHeadBalacePage()" checked>{{'Chosen product flowrate'|translate}}
                    <span class="custom-control-indicator"></span>
                  </label>
                </div>
                <div class="col-md-6" align="center" >
                  <label class="custom-control custom-radio" >
                    <input type="radio" class="custom-control-input" name="DHP" (change)="openHeadBalaceMaxPage()">￼{{'Maximum product flowrate'|translate}}
                    <span class="custom-control-indicator"></span>
                  </label>
                </div>
              </div>
              
              <div class="table-responsive">
                <table class="table table-bordered table-sm" *ngIf="resultAna">
                  <tr *ngIf="symbol && resultAna">
                    <td align="center" style="vertical-align: middle">{{'Required Production Rate'|translate}}</td>
                    <td align="center" style="vertical-align: middle">{{resultAna.prodFlowRate}} ({{symbol.productFlowSymbol}})</td>
                    <td align="center" style="vertical-align: middle">{{'Real product mass per unit'|translate}}</td>
                    <td align="center" style="vertical-align: middle">{{ resultAna.prodElmtRealweight }}({{symbol.massSymbol}})</td>
                    <td align="center" style="vertical-align: middle">{{'Initial Average Product temperature'|translate}}</td>
                    <td align="center" style="vertical-align: middle">{{resultAna.avgTInitial}} ({{symbol.temperatureSymbol}})</td>
                  </tr>
                </table>
              </div>

              <div id="headBalacePage">
                <div class="table-responsive">
                  <table class="table table-bordered table-sm" *ngIf="symbol">
                    <tr>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Calculate'|translate}}</td>
                      <td rowspan="2" align="center" style="vertical-align:middle;width:19%">{{'Equipment'|translate}}</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Refine'|translate}}</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Control temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Residence / Dwell time'|translate}} ({{symbol.timeSymbol}})</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Product Heat Load'|translate}} ({{symbol.enthalpySymbol}})</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Final Average Product temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                      <td colspan="3" align="center" style="vertical-align:middle">{{'Chosen product flowrate'|translate}}</td>
                      <td rowspan="2" align="center" style="vertical-align:middle">{{'Precision of the high level calculation'|translate}}. ({{symbol.percentSymbol}})</td>
                    </tr>
                    <tr>
                      <td align="center" style="vertical-align:middle">{{'Hourly production capacity'|translate}} ({{symbol.productFlowSymbol}})</td>
                      <td align="center" style="vertical-align:middle">{{'Cryogen consumption (product + equipment heat load)'|translate}} ({{symbol.consumSymbol}}/{{symbol.perUnitOfMassSymbol}})</td>
                      <td align="center" style="vertical-align:middle">{{'Conveyor coverage or quantity of product per batch'|translate}}</td>
                    </tr>
                    <tr *ngFor="let result of headBalanceResults, let i = index" [style.background-color]="result.background">
                      <td align="center" class="tdResultAna" >
                        <label class="custom-control custom-checkbox" style="margin-left:1.5em;margin-top:0.7em;">
                          <input type="checkbox" name="cb{{result.id}}" class="custom-control-input" [disabled]="result.calculate">
                          <span class="custom-control-indicator"></span>
                        </label>
                      </td>
                      <td align="center" class="tdResultLink"style="vertical-align:middle">
                        <a href="javascript:;" class="tdResultLink" (click)="calculator.openRefine(result.id, false, 1)">{{result.equipName}}</a>
                        <div *ngIf="result.specificSize != ''">
                          <div><a href="javascript:;" (click)="onEquipSizing(result.id)" style="color:#f00">{{'Specific equipment'|translate}}<br>{{result.specificSize}}</a></div>
                        </div>
                      </td>
                      <td align="center" class="tdResultLink"style="vertical-align:middle">
                        <button class="btn btn-outline-success" (click)="calculator.openRefine(result.id, true, 2)">
                          <i class="fa fa-recycle"></i>
                        </button>
                      </td>
                      <td align="center" class="tdResultAna" style="vertical-align:middle" *ngIf="isNumberic(result.tr) == true;else noTooltip">
                        <a href="javascript:;" placement="right" [ngbTooltip]="tipContent">{{result.tr}}</a>
                        <ng-template #tipContent>
                          <div class="text-left" style="padding: 3px 0;font-size:13px">
                            <div style="white-space:nowrap">{{'Control temperature'|translate}}: <b>{{result.tr}}</b> ({{symbol.temperatureSymbol}})</div>
                            <div style="white-space:nowrap">{{'Residence/Dwell time'|translate}}: <b>{{result.ts}}</b> ({{symbol.timeSymbol}})</div>
                            <div style="white-space:nowrap">{{'Convection Setting'|translate}}: <b>{{result.vc}}</b> ({{symbol.convectionSpeedSymbol}})</div>
                          </div>
                        </ng-template>
                      </td>
                      <ng-template #noTooltip>
                      <td align="center" class="tdResultAna" style="vertical-align:middle">
                        <a href="javascript:;">{{result.tr}}</a>
                      </td>  
                      </ng-template>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.ts}}</td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.vep}}</td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tfp}}</td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.dhp}}</td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">
                          <div *ngIf="result.conso_warning == 'warning_fluid'"><img src="assets/img/output/warning_fluid_overflow.gif" width="30"></div>
                          <div *ngIf="result.conso_warning == 'warning_dhp'"><img src="assets/img/output/warning_fluid_overflow.gif" width="30"><img src="assets/img/output/warning_dhp_overflow.gif" width="30"></div>
                          <div *ngIf="result.conso_warning == 'warning_dhp_value'"><div>{{result.conso}}</div><img src="assets/img/output/warning_dhp_overflow.gif" width="30"></div>
                          <div *ngIf="result.conso_warning != 'warning_fluid' && result.conso_warning != 'warning_dhp' && result.conso_warning != 'warning_dhp_value'">{{result.conso}}</div>
                      </td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">
                        <a href="javascript:;" *ngIf="result.toc != '' && result.toc != '****';else txtToc" (click)="equipEditLayout(result.id, i)">{{result.toc}}</a>
                        <ng-template #txtToc>{{result.toc}}</ng-template>
                      </td>
                      <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.precision}}</td>
                    </tr>
                  </table>
                </div>
              </div>
              <div id="headBalaceMaxPage" style=display:none>
                <table class="table table-bordered table-sm" *ngIf="symbol">
                  <tr>
                    <td rowspan="2" align="center" style="vertical-align:middle;width:19%">{{'Equipment'|translate}}</td>
                    <td rowspan="2" align="center" style="vertical-align:middle">{{'Control temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                    <td rowspan="2" align="center" style="vertical-align:middle">{{'Residence / Dwell time'|translate}} ({{symbol.timeSymbol}})</td>
                    <td rowspan="2" align="center" style="vertical-align:middle">{{'Product Heat Load'|translate}} ({{symbol.enthalpySymbol}})</td>
                    <td rowspan="2" align="center" style="vertical-align:middle">{{'Final Average Product temperature'|translate}} ({{symbol.temperatureSymbol}})</td>
                    <td colspan="3" align="center" style="vertical-align:middle">{{'Chosen product flowrate'|translate}}</td>
                    <td rowspan="2" align="center" style="vertical-align:middle">{{'Precision of the high level calculation'|translate}}. ({{symbol.percentSymbol}})</td>
                  </tr>
                  <tr>
                    <td align="center" style="vertical-align:middle">{{'Hourly production capacity'|translate}} ({{symbol.productFlowSymbol}})</td>
                    <td align="center" style="vertical-align:middle">{{'Cryogen consumption (product + equipment heat load)'|translate}} ({{symbol.consumSymbol}}/{{symbol.perUnitOfMassSymbol}})</td>
                    <td align="center" style="vertical-align:middle">{{'Conveyor coverage or quantity of product per batch'|translate}}</td>
                  </tr>
                  <tr *ngFor="let result of headBalanceMaxResults" [style.background-color]="result.background">
                    <td align="center" class="tdResultLink"style="vertical-align:middle;width:19%">
                      <a href="javascript:;" class="tdResultLink" (click)="calculator.openRefine(result.id, true, 3)">{{result.equipName}}</a>
                      <div *ngIf="result.specificSize != ''">
                        <div><a href="javascript:;">{{'Specific equipment'|translate}}<br>{{result.specificSize}}</a></div>
                      </div>
                    </td>
                    <td align="center" class="tdResultAna" style="vertical-align:middle" *ngIf="isNumberic(result.tr) == true;else noTooltip">
                      <a href="javascript:;" placement="right" [ngbTooltip]="tipContent">{{result.tr}}</a>
                      <ng-template #tipContent>
                        <div class="text-left" style="padding: 3px 0;font-size:13px">
                          <div style="white-space:nowrap">{{'Control temperature'|translate}}: <b>{{result.tr}}</b> ({{symbol.temperatureSymbol}})</div>
                          <div style="white-space:nowrap">{{'Residence/Dwell time'|translate}}: <b>{{result.ts}}</b> ({{symbol.timeSymbol}})</div>
                          <div style="white-space:nowrap">{{'Convection Setting'|translate}}: <b>{{result.vc}}</b> ({{symbol.convectionSpeedSymbol}})</div>
                        </div>
                      </ng-template>
                    </td>
                    <ng-template #noTooltip>
                    <td align="center" class="tdResultAna" style="vertical-align:middle">
                      <a href="javascript:;">{{result.tr}}</a>
                    </td>  
                    </ng-template>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.ts}}</td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.vep}}</td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tfp}}</td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.dhp}}</td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">
                      <div *ngIf="result.conso_warning == 'warning_fluid'"><img src="assets/img/output/warning_fluid_overflow.gif" width="30"></div>
                      <div *ngIf="result.conso_warning == 'warning_dhp'"><img src="assets/img/output/warning_fluid_overflow.gif" width="30"><img src="assets/img/output/warning_dhp_overflow.gif" width="30"></div>
                      <div *ngIf="result.conso_warning == 'warning_dhp_value'"><div>{{result.conso}}</div><img src="assets/img/output/warning_dhp_overflow.gif" width="30"></div>
                      <div *ngIf="result.conso_warning != 'warning_fluid' && result.conso_warning != 'warning_dhp' && result.conso_warning != 'warning_dhp_value'">{{result.conso}}</div>
                    </td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.toc}}</td>
                    <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.precision}}</td>
                  </tr>
                </table>
            </div>
        </div>
      </div>
      <div style="display:none;margin-top:10px;" id="pageConsumption">
        <h5 class="text-danger" style="font-weight:600">{{'Consumptions'|translate}}</h5>
        <div class="table-responsive">
          <table class="table table-bordered table-sm" style="margin-top:10px;" *ngIf="symbol">
            <tr>
              <td rowspan="2" align="center"style="vertical-align:middle;font-size:12px;width:19%">{{'Equipment'|translate}}</td>
              <td rowspan="2"style="vertical-align:middle;font-size:12px;" align="center">
                {{'Overall Cryogen Consumption Ratio (product + equipment and pipeline losses) Unit of Cryogen, per piece of product.'|translate}} ({{symbol.consumSymbol}})
              </td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;"  align="center">
                {{'Total Cryogen Consumption (product + equipment and pipeline losses).'|translate}} ({{symbol.consumSymbol}} /{{symbol.perUnitOfMassSymbol}})
              </td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;"  align="center">
                {{'Specific Cryogen Consumption Ratio (product only) Unit of Cryogen, per unit weight of product.'|translate}} ({{symbol.consumSymbol}} /{{symbol.perUnitOfMassSymbol}})
              </td>
              <td colspan="4" style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption'|translate}}</td>
              <td colspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Equipment Cryogen Consumption'|translate}}</td>
              <td colspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Pipeline consumption'|translate}}</td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Tank losses'|translate}} ({{symbol.consumSymbol}})</td>
            </tr>
            <tr>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per year'|translate}} ({{symbol.consumSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per week'|translate}} ({{symbol.consumSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per day'|translate}} ({{symbol.consumSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per hour'|translate}} ({{symbol.consumSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Heat losses per hour'|translate}} ({{symbol.consumMaintienSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Cooldown'|translate}} ({{symbol.mefSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;"  align="center">{{'Heat losses per hour'|translate}} ({{symbol.consumMaintienSymbol}})</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Cooldown'|translate}} ({{symbol.mefSymbol}})</td>
            </tr>
            <tr *ngFor="let result of commonResults">
                <td align="center" class="tdResultLink"style="vertical-align:middle">
                    <a href="javascript:;" placement="right" [ngbTooltip]="tipContent" class="tdResultLink" (click)="onConsumptionPie(result)">{{result.equipName}}</a>
                    <ng-template #tipContent>
                      <div class="text-left" style="padding: 3px 0;font-size:13px">
                        <div style="white-space:nowrap">{{'Product'|translate}}: <b class="pull-right">{{result.percentProduct}}%</b></div>
                        <div style="white-space:nowrap">{{'Equipment(permanent'|translate}}: <b class="pull-right">{{result.percentEquipmentPerm}}%</b></div>
                        <div style="white-space:nowrap">{{'Equipment(cool down)'|translate}}: <b class="pull-right">{{result.percentEquipmentDown}}%</b></div>
                        <div style="white-space:nowrap">{{'Line'|translate}}: <b class="pull-right">{{result.percentLine}}%</b></div>
                      </div>
                    </ng-template>
                </td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tc}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.kgProduct}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.product}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.year}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.week}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.day}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.hour}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.eqptPerm}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.eqptCold}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.linePerm}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.lineCold}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tank}}</td>
            </tr>
          </table>
        </div>
      </div>
      <div style="display:none;margin-top:10px;" id="pageEconomics">
        <h5 class="text-danger" style="font-weight:600">{{'Economic results'|translate}}</h5>
        <div class="table-responsive">
          <table class="table table-bordered table-sm" style="margin-top:10px;" *ngIf="symbol">
            <tr>
              <td rowspan="2" align="center"style="vertical-align:middle;font-size:12px;width:19%">{{'Equipment'|translate}}</td>
              <td rowspan="2"style="vertical-align:middle;font-size:12px;" align="center">
                {{'Overall Cryogen Consumption Ratio (product + equipment and pipeline losses) Unit of Cryogen, per piece of product.'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)
              </td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;"  align="center">
                {{'Total Cryogen Consumption (product + equipment and pipeline losses).'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span> /{{symbol.perUnitOfMassSymbol}})
              </td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;"  align="center">
                {{'Specific Cryogen Consumption Ratio (product only) Unit of Cryogen, per unit weight of product.'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span> /{{symbol.perUnitOfMassSymbol}})
              </td>
              <td colspan="4" style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption'|translate}}</td>
              <td colspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Equipment Cryogen Consumption'|translate}}</td>
              <td colspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Pipeline consumption'|translate}}</td>
              <td rowspan="2" style="vertical-align:middle;font-size:12px;" align="center">{{'Tank losses'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
            </tr>
            <tr>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per year'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per week'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per day'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Total Cryogen Consumption per hour'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Heat losses per hour'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span> /h)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Cooldown'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
              <td style="vertical-align:middle;font-size:12px;"  align="center">{{'Heat losses per hour'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span> /h)</td>
              <td style="vertical-align:middle;font-size:12px;" align="center">{{'Cooldown'|translate}}<br>(<span [innerHTML]="symbol.monetarySymbol"></span>)</td>
            </tr>
            <tr *ngFor="let result of economicResults">
                <td align="center" class="tdResultLink"style="vertical-align:middle">
                  <a href="javascript:;" class="tdResultLink">{{result.equipName}}</a>
                </td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tc}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.kgProduct}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.product}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.year}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.week}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.day}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.hour}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.eqptPerm}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.eqptCold}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.linePerm}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.lineCold}}</td>
                <td align="center" class="tdResultAna"style="vertical-align:middle">{{result.tank}}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noResult>
    <div class="card" *ngIf="checkcontrol">
      <div class="card-body text-center text-muted" *ngIf="checkcontrol.checkcontrol;else isCheckControl">
        <p>{{'No data to display'|translate}}</p>
        <div style="padding-top:10px">
          <button class="btn btn-primary btn-lg text-uppercase" (click)="calculator.open()">{{'Calculate'|translate}}</button>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template #isCheckControl>
    <div class="card">
      <div class="card-body text-center text-muted">
        <p>{{'No data to display'|translate}}</p>
        <div style="padding-top:10px">
          <button class="btn btn-primary btn-lg text-uppercase" disabled>{{'Calculate'|translate}}</button>
        </div>
      </div>
    </div>
  </ng-template>

</div>

<div bsModal class="modal modal-primary fade" #consumptionPieModal="bs-modal" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header" *ngIf="chartPieData">
        <div class="text-center" style="width:100%">
            <h5>{{chartPieData.name}}</h5>
        </div>
        <button class="close" arria-label="Close" data-dismiss="modal" (click)="consumptionPieModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- <div class="chart-wrapper" *ngIf="pieData && displayPie == true">
          <canvas #myChart baseChart class="chart"
          [datasets]="pieData"
          [labels]="pieLabels"
          [colors]="pieColours"
          [options]="pieOptions"
          [chartType]="pieChartType"></canvas>
        </div>
        <div class="chart-wrapper" *ngIf="pieDataNone && displayPie == false">
          <canvas baseChart class="chart"
          [datasets]="pieDataNone"
          [labels]="pieLabelsNone"
          [colors]="pieColoursNone"
          [options]="pieOptionsNone"
          [chartType]="pieChartTypeNone"></canvas>
        </div> -->
        <div class="text-center" *ngIf="imageConsumptionPie != ''">
          <img [src]="imageConsumptionPie">
        </div>
        <div class="text-center" style="margin-top: 25px;margin-bottom:10px">
            <input type="checkbox" [(ngModel)]="ENABLE_CONS_PIE" [disabled]="!studyModifiable()" (change)="addConsPieToReport()" style="margin:0;margin-right: 5px;vertical-align: middle"><span style="vertical-align: middle">{{'Add this graph to the report'|translate}}</span>
        </div>
        <div class="text-center">
            <button class="btn btn-secondary btn-sm" (click)="closePie()">{{'Close'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div bsModal class="modal modal-primary fade" #equipSizingModal="bs-modal" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div class="text-center" style="width:100%">
            <h5 *ngIf="equipSizingName">{{'Define Equipment Size'|translate}} - {{equipSizingName}}</h5>
        </div>
        <button class="close" arria-label="Close" data-dismiss="modal" (click)="equipSizingModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-bordered table-sm mb-0 text-center" *ngIf="symbol">
          <thead>
            <tr>
              <ng-container *ngIf="study.CALCULATION_MODE == 1;else equipSizingOptimumLabel">
                <th>{{ 'Width'|translate }} ({{ symbol.equipDimensionSymbol }})</th>
                <th>{{ 'Length'|translate }} ({{ symbol.equipDimensionSymbol }})</th>
              </ng-container>
              <ng-template #equipSizingOptimumLabel>
                <th>{{ 'Length'|translate }} ({{ symbol.equipDimensionSymbol }})</th>
                <th>{{ 'Width'|translate }} ({{ symbol.equipDimensionSymbol }})</th>
              </ng-template>
              <th>{{ 'Surface'|translate }} ({{ symbol.equipDimensionSymbol }}²)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <ng-container *ngIf="study.CALCULATION_MODE == 1;else equipSizingOptimum">
                  <td align="center" style="vertical-align:middle">
                      <input *ngIf="equipSizingDisable == false;else equipSizingWidthOther" type="text" [(ngModel)]="equipSizingWidth" (change)="calculateLength()" class="form-control">
                      <ng-template #equipSizingWidthOther>
                        <span style="display:inline-block;line-height:35px">{{equipSizingWidth}}</span>
                      </ng-template>
                  </td>
                  <td align="center" style="vertical-align:middle">
                      <input *ngIf="equipSizingDisable == false;else equipSizingLengthOther" type="text" [(ngModel)]="equipSizingLength" (change)="calculateWidth()" class="form-control">
                      <ng-template #equipSizingLengthOther>
                        <span style="display:inline-block;line-height:35px">{{equipSizingLength}}</span>
                      </ng-template>
                    </td>
              </ng-container>
              <ng-template #equipSizingOptimum>
                  <td align="center" style="vertical-align:middle">
                      <input *ngIf="equipSizingDisable == false;else equipSizingLengthOther" type="text" [(ngModel)]="equipSizingLength" (change)="calculateWidth()" class="form-control">
                      <ng-template #equipSizingLengthOther>
                        <span style="display:inline-block;line-height:35px">{{equipSizingLength}}</span>
                      </ng-template>
                    </td>
                    <td align="center" style="vertical-align:middle">
                        <input *ngIf="equipSizingDisable == false;else equipSizingWidthOther" type="text" [(ngModel)]="equipSizingWidth" (change)="calculateLength()" class="form-control">
                        <ng-template #equipSizingWidthOther>
                          <span style="display:inline-block;line-height:35px">{{equipSizingWidth}}</span>
                        </ng-template>
                    </td>
              </ng-template>
              <td align="center" style="vertical-align:middle">
                  <input *ngIf="equipSizingDisable == false;else equipSizingSurfaceOther" type="text" [(ngModel)]="equipSizingSurface" (change)="calculateLength()" class="form-control">
                  <ng-template #equipSizingSurfaceOther>
                    <span style="display:inline-block;line-height:35px">{{equipSizingSurface}}</span>
                  </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
        <p></p>
        <div class="text-primary" *ngIf="equipSizing && equipSizing.disabled == false">
          <span>{{'Possibility to calculate width from length and the opposite.'|translate}}</span><br>
          <span>{{'Length is updated on change of surface.'|translate}}</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal" (click)="equipSizingModal.hide()">{{ 'Cancel'|translate }}</button>
        <button class="btn btn-primary" *ngIf="equipSizingDisable == false" (click)="saveEquipSizing()">{{ 'Calculation'|translate }}</button>
      </div>
    </div>
  </div>
</div>

<div bsModal class="modal modal-primary fade" #viewEquipTrModal="bs-modal" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <div class="text-center" style="width:100%">
            <h5 *ngIf="viewEquipTrData">{{viewEquipTrData.equipName}} <span *ngIf="viewEquipTrData.specificSize != ''">- {{viewEquipTrData.specificSize}}</span></h5>
        </div>
        <button class="close" arria-label="Close" data-dismiss="modal" (click)="viewEquipTrModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-bordered table-sm mb-0 text-center" *ngIf="symbol">
          <thead>
            <tr>
              <th>{{ 'Control temperature'|translate }} ({{ symbol.temperatureSymbol }})</th>
              <th>{{ 'Residence / Dwell time'|translate }} ({{ symbol.timeSymbol }})</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="viewEquipTrData">
              <td>{{viewEquipTrData.tr}}</td>
              <td>{{viewEquipTrData.ts}}</td>
            </tr>
          </tbody>
        </table>
        <p></p>
        <div class="text-center">
          <button class="btn btn-secondary" (click)="viewEquipTrModal.hide()">{{'Close'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div bsModal class="modal modal-primary fade bd-example-modal-lg" #editEquipTrModal="bs-modal" role="dialog" aria-hidden="true"  >
  <div class="modal-dialog" role="document" style="max-width:50%;">
    <div class="modal-content">
      <div class="modal-header">
        <div class="text-center" style="width:100%">
          <h5 *ngIf="viewEquipTrData">{{viewEquipTrData.equipName}} <span *ngIf="viewEquipTrData.specificSize != ''">- {{viewEquipTrData.specificSize}}</span></h5>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeEditEquipTrModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-bordered table-sm"  >
            <thead>
              <tr *ngIf="symbol">
                <td align="center"><strong>{{'Residence / Dwell time'|translate}} ({{symbol.timeSymbol}})</strong></td>
                <td align="center"><strong>{{'Control temperature '|translate}} ({{symbol.temperatureSymbol}})</strong></td>
                <td align="center"><strong>{{'Convection Setting '|translate}} ({{symbol.convectionSpeedSymbol}})</strong></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="operatingSetting">
                <td align="center">
                  <div class="form-group" *ngFor="let item of studyEquipment.ts, let i = index">
                    <input type="text" class="form-control" [(ngModel)]="tsValue[i]" style="width:80px">
                  </div>
                  <button class="btn btn-md btn-primary" [ladda]="laddaCalTr" (click)="calcTr()">{{'Compute Control Temperature'|translate}}</button>
                </td>
                <td align="center">
                  <div class="form-group" *ngFor="let item of studyEquipment.tr, let i = index">
                    <input type="text" class="form-control" [(ngModel)]="trValue[i]" [disabled]="disabledTr" style="width:80px">
                  </div>
                  <button class="btn btn-md btn-primary" [ladda]="laddaCalTs" (click)="calcTs()">{{'Compute Residence/Dwell Time'|translate}}</button>
                </td>
                <td align="center">
                  <div *ngFor="let item of studyEquipment.vc, let i = index">
                    <input type="text" class="form-control" [(ngModel)]="vcValue[i]" disabled style="width:80px">
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div style="padding: 5px 0"><strong *ngIf="symbol">{{'Gas Temperature'|translate}} ({{symbol.temperatureSymbol}}):</strong></div>
        <div class="row">
          <div class="col-md-2" *ngIf="operatingSetting">
            <input type="text" class="form-control" [(ngModel)]="studyEquipment.TExt" style="width:80px">
          </div>
        </div>
        <div style="float:right;margin-right:20px;" >
          <button class="btn btn-md btn-secondary" (click)="closeEditEquipTrModal()">{{'Cancel'|translate}}</button>
          <button class="btn btn-md btn-primary" [ladda]="laddaCalculationEquip" (click)="submitCalculate()">{{'Calculation'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div bsModal class="modal fade bd-example-modal-lg" #editModal="bs-modal" role="dialog" aria-hidden="true"  >
  <div class="modal-dialog modal-primary" role="document" style="max-width:60%;" *ngIf="editLayoutForm">
    <div class="modal-content">
      <div class="modal-header"><strong >{{'TOC Wizard'|translate}}</strong>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeEditModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      <h5 class="text-danger" *ngIf="equipment">{{ equipment.displayName }}</h5>
      <div style="padding: 5px 0"><strong >Input :</strong></div>
      <div class="row">
        <div class="col-md-8">
          <div class="form-group row">
            <div class="col-md-6" *ngIf="symbol">{{'Spaces (length x width)'|translate}} ({{symbol.equipDimensionSymbol}})</div>
            <input type="text" class="col-md-2" style="height:30px;" [disabled]="!studyModifiable()" [(ngModel)]="editLayoutForm.lengthInterval">
            <div class="col-md-2"></div>
            <input type="text"class="col-md-2" style="height:30px;" [disabled]="!studyModifiable()" [(ngModel)]="editLayoutForm.widthInterval">
          </div>
          <div class="form-group row">
            <div class="col-md-6">{{'Orientation'|translate}}</div>
            <select class="form-control col-md-6" [disabled]="!studyModifiable()" [(ngModel)]="editLayoutForm.orientation">
                <option value="1">{{'Parallel'|translate}}</option>
                <option value="0">{{'Perpendicular'|translate}}</option>
            </select>
          </div>
          <div class="form-group row" *ngIf="1==0">
            <div class="col-md-6">{{'Shelves'|translate}}</div>
            <select class="form-control col-md-6"></select>
          </div>
          <div class="form-group row" *ngIf="1==0">
            <div class="col-md-6" *ngIf="symbol">{{'Dimensions'|translate}} ({{'length'|translate}} x {{'width'|translate}}) ({{symbol.prodDimensionSymbol}})</div>
            <input type="text" class="col-md-2" style="height:30px;" >
            <div class="col-md-2"></div>
            <input type="text"class="col-md-2" style="height:30px;">
          </div>
          <div class="form-group row" *ngIf="1==0">
            <div class="col-md-6">{{'Number of shelves'|translate}}</div>
            <input type="text" class="col-md-3" style="height:30px;" >
          </div>
        </div>
        <div class="col-md-4">
          <img id="stdEqpLayoutImg" style="width: 100%">
        </div>
      </div>
      <div style="padding:10px;"><strong >{{'Output'|translate}} :</strong></div>
      <table class="table  table-bordered table-sm"  *ngIf="equipment" >
        <thead>
          <tr *ngIf="symbol">
            <td align="center" *ngIf="equipment.ORIENTATION == 0;else equipTitle;"><strong>Width of Spaces. ({{symbol.shelvesWidthSymbol}})</strong></td>
            <ng-template #equipTitle>
            <td align="center"><strong>Side remaining interval ({{symbol.shelvesWidthSymbol}})</strong></td>
            </ng-template>
            <td align="center" *ngIf="equipment.ORIENTATION == 1;else equipNumberPer;"><strong> {{'Number per tunnel length'|translate}}</strong></td>
            <ng-template #equipNumberPer>
            <td align="center"><strong>{{'Number of items per meter run'|translate}}. ({{symbol.shelvesWidthSymbol}})</strong></td>
            </ng-template>
            <td align="center"><strong> {{'Number of items in belt width'|translate}}.</strong></td>
            <td align="center"><strong> {{'Conveyor coverage or quantity of product per batch'|translate}}</strong></td>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="symbol && equipment.layoutResults != ''">
            <td align="center">{{equipment.layoutResults.LEFT_RIGHT_INTERVAL}}</td>
            <td align="center">{{equipment.layoutResults.NUMBER_PER_M}}</td>
            <td align="center">{{equipment.layoutResults.NUMBER_IN_WIDTH}}</td>
            <td align="center" *ngIf="equipment">{{equipment.top_or_QperBatch}}</td>
          </tr>
        </tbody>
      </table>
      <div>
        <strong style="padding:15px;" *ngIf="equipment.layoutResults != ''">{{'Belt coverage'|translate}} <input type="text" value="{{equipment.layoutResults.LOADING_RATE}}" style="heigth:30px;width:60px;"> (%)</strong>
        <div style="float:right;margin-right:20px;" >
          <button class="btn btn-md btn-secondary" (click)="closeEditModal()">{{'Close'|translate}}</button>
          <button class="btn btn-md btn-primary" [disabled]="!studyModifiable()" [ladda]="laddaUpdateLayout" (click)="updateStdEquipLayout()">{{'Apply'|translate}}</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<app-calculator #calculator (finishCalculate)="onFinishCalculate()"></app-calculator>
